# ğŸ›¡ï¸ Sistema de DetecciÃ³n de Somnolencia - Educare IA

<div align="center">

![Version](https://img.shields.io/badge/version-1.0.0-blue.svg)
![Python](https://img.shields.io/badge/python-3.12+-green.svg)
![FastAPI](https://img.shields.io/badge/FastAPI-0.109.0-009688.svg)
![Flet](https://img.shields.io/badge/Flet-0.21.0-purple.svg)
![MediaPipe](https://img.shields.io/badge/MediaPipe-0.10.9-orange.svg)
![License](https://img.shields.io/badge/license-MIT-red.svg)

**Sistema avanzado de monitoreo en tiempo real para detectar signos de somnolencia mediante visiÃ³n por computadora e inteligencia artificial.**

[CaracterÃ­sticas](#-caracterÃ­sticas-principales) â€¢
[Arquitectura](#-arquitectura-del-sistema) â€¢
[InstalaciÃ³n](#-instalaciÃ³n) â€¢
[Uso](#-uso) â€¢
[DocumentaciÃ³n](#-documentaciÃ³n-tÃ©cnica)

</div>

---

## ğŸ“‹ Tabla de Contenidos

- [DescripciÃ³n General](#-descripciÃ³n-general)
- [CaracterÃ­sticas Principales](#-caracterÃ­sticas-principales)
- [Arquitectura del Sistema](#-arquitectura-del-sistema)
- [Flujo de Datos](#-flujo-de-datos)
- [Componentes Detallados](#-componentes-detallados)
- [InstalaciÃ³n](#-instalaciÃ³n)
- [Uso](#-uso)
- [MÃ©tricas de DetecciÃ³n](#-mÃ©tricas-de-detecciÃ³n)
- [DocumentaciÃ³n TÃ©cnica](#-documentaciÃ³n-tÃ©cnica)
- [ContribuciÃ³n](#-contribuciÃ³n)

---

## ğŸ¯ DescripciÃ³n General

El **Sistema de DetecciÃ³n de Somnolencia** es una aplicaciÃ³n de escritorio que utiliza visiÃ³n por computadora para monitorear en tiempo real los signos de fatiga y somnolencia en conductores u operadores de maquinaria. El sistema analiza 468 puntos faciales y detecta patrones de comportamiento asociados con el cansancio.

### ğŸ­ CaracterÃ­sticas de DetecciÃ³n

| CaracterÃ­stica | DescripciÃ³n | Umbral de Alerta |
|----------------|-------------|------------------|
| ğŸ‘ï¸ **Parpadeo** | Frecuencia de parpadeo anormal | > 15 parpadeos/min |
| ğŸ˜´ **MicrosueÃ±o** | Ojos cerrados prolongadamente | > 2 segundos |
| ğŸ¥± **Bostezo** | Apertura excesiva de la boca | > 4 segundos |
| ğŸ™‡ **Cabeceo** | InclinaciÃ³n de cabeza hacia abajo | > 3 segundos |
| ğŸ¤² **Frotamiento de ojos** | Manos cerca de los ojos | > 1 segundo |

---

## âœ¨ CaracterÃ­sticas Principales

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘  ğŸš€ CARACTERÃSTICAS DEL SISTEMA                                â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                â•‘
â•‘  âœ“ DetecciÃ³n en tiempo real (30+ FPS)                        â•‘
â•‘  âœ“ AnÃ¡lisis de 468 puntos faciales (MediaPipe)               â•‘
â•‘  âœ“ DetecciÃ³n de hasta 2 manos simultÃ¡neamente                â•‘
â•‘  âœ“ Sistema de alertas visuales multinivel                     â•‘
â•‘  âœ“ GeneraciÃ³n automÃ¡tica de reportes CSV                      â•‘
â•‘  âœ“ VisualizaciÃ³n 3D de puntos faciales                        â•‘
â•‘  âœ“ Interfaz grÃ¡fica moderna con Flet                          â•‘
â•‘  âœ“ Arquitectura cliente-servidor con WebSockets               â•‘
â•‘  âœ“ Procesamiento asÃ­ncrono de alto rendimiento                â•‘
â•‘  âœ“ Sistema modular y extensible                               â•‘
â•‘                                                                â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ—ï¸ Arquitectura del Sistema

### ğŸ“ Diagrama de Arquitectura General

```mermaid
graph TB
    subgraph "ğŸ–¥ï¸ CAPA DE PRESENTACIÃ“N"
        A[ğŸ‘¤ Usuario]
        B[ğŸ¨ Interfaz GrÃ¡fica Flet]
        C[ğŸ“¹ Captura de CÃ¡mara]
    end
    
    subgraph "ğŸŒ CAPA DE COMUNICACIÃ“N"
        D[ğŸ”Œ WebSocket Cliente]
        E[ğŸ”Œ WebSocket Servidor]
    end
    
    subgraph "âš™ï¸ CAPA DE PROCESAMIENTO"
        F[ğŸ§  Sistema Principal]
        G[ğŸ“ Extractor de Puntos]
        H[ğŸ“Š Procesador de Datos]
        I[ğŸ¯ Detector de CaracterÃ­sticas]
        J[ğŸ“ˆ Generador de Reportes]
        K[ğŸ¨ Visualizador]
    end
    
    subgraph "ğŸ”¬ MÃ“DULOS DE ANÃLISIS"
        L[ğŸ‘ï¸ MediaPipe Face Mesh<br/>468 puntos faciales]
        M[ğŸ¤² MediaPipe Hands<br/>42 puntos por mano]
    end
    
    subgraph "ğŸ’¾ CAPA DE PERSISTENCIA"
        N[(ğŸ“„ CSV Reports)]
        O[(ğŸ“Š JSON Logs)]
    end
    
    A --> B
    B --> C
    C --> D
    D <--> E
    E <--> F
    F --> G
    G --> L
    G --> M
    L --> H
    M --> H
    H --> I
    I --> J
    I --> K
    J --> N
    J --> O
    K --> F
    F --> E
    
    style A fill:#e1f5ff
    style B fill:#b3e5fc
    style F fill:#81c784
    style G fill:#ffb74d
    style H fill:#ffb74d
    style I fill:#ffb74d
    style J fill:#ba68c8
    style K fill:#ba68c8
    style L fill:#ff8a65
    style M fill:#ff8a65
    style N fill:#90a4ae
    style O fill:#90a4ae
```

### ğŸ”„ Arquitectura en Capas 3D

```
                    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                    â•‘     ğŸ¨ CAPA DE PRESENTACIÃ“N (GUI)            â•‘
                    â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
                    â•‘  â”‚  ğŸ  Start Page                          â”‚ â•‘
                    â•‘  â”‚  ğŸ¯ Selection Interface                 â”‚ â•‘
                    â•‘  â”‚  ğŸ˜´ Drowsiness Detection Page          â”‚ â•‘
                    â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                       â”‚
                                       â–¼
                    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                    â•‘    ğŸŒ CAPA DE TRANSPORTE (WebSocket)         â•‘
                    â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
                    â•‘  â”‚  ğŸ“¤ Cliente: EnvÃ­o de frames            â”‚ â•‘
                    â•‘  â”‚  ğŸ“¥ Servidor: RecepciÃ³n y respuesta     â”‚ â•‘
                    â•‘  â”‚  ğŸ”„ ComunicaciÃ³n bidireccional          â”‚ â•‘
                    â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                       â”‚
                                       â–¼
    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
    â•‘              âš™ï¸ CAPA DE LÃ“GICA DE NEGOCIO (Core)                     â•‘
    â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
    â•‘  â”‚                                                                  â”‚ â•‘
    â•‘  â”‚  ğŸ“ Points Extraction Layer                                      â”‚ â•‘
    â•‘  â”‚  â”œâ”€â”€ ğŸ‘ï¸ Face Mesh Processor (468 landmarks)                     â”‚ â•‘
    â•‘  â”‚  â””â”€â”€ ğŸ¤² Hands Processor (21 landmarks Ã— 2 hands)                â”‚ â•‘
    â•‘  â”‚                                                                  â”‚ â•‘
    â•‘  â”‚  ğŸ“Š Data Processing Layer                                        â”‚ â•‘
    â•‘  â”‚  â”œâ”€â”€ ğŸ‘ï¸ Eyes Processor (Distancias euclidiana)                  â”‚ â•‘
    â•‘  â”‚  â”œâ”€â”€ ğŸ‘„ Mouth Processor (Apertura labial)                       â”‚ â•‘
    â•‘  â”‚  â”œâ”€â”€ ğŸ¯ Head Processor (Ãngulo pitch)                           â”‚ â•‘
    â•‘  â”‚  â””â”€â”€ âœ‹ Hands Processor (Proximidad a ojos)                     â”‚ â•‘
    â•‘  â”‚                                                                  â”‚ â•‘
    â•‘  â”‚  ğŸ¯ Features Detection Layer                                     â”‚ â•‘
    â•‘  â”‚  â”œâ”€â”€ ğŸ‘ï¸ Flicker & Microsleep (Contador de parpadeos)            â”‚ â•‘
    â•‘  â”‚  â”œâ”€â”€ ğŸ¥± Yawn Detection (DuraciÃ³n de bostezos)                   â”‚ â•‘
    â•‘  â”‚  â”œâ”€â”€ ğŸ™‡ Pitch Detection (DetecciÃ³n de cabeceo)                  â”‚ â•‘
    â•‘  â”‚  â””â”€â”€ ğŸ¤² Eye Rub Detection (Frotamiento de ojos)                 â”‚ â•‘
    â•‘  â”‚                                                                  â”‚ â•‘
    â•‘  â”‚  ğŸ“ˆ Reporting & Visualization Layer                             â”‚ â•‘
    â•‘  â”‚  â”œâ”€â”€ ğŸ“Š Report Generator (CSV & JSON)                           â”‚ â•‘
    â•‘  â”‚  â””â”€â”€ ğŸ¨ Visual Alerts (Overlay en video)                        â”‚ â•‘
    â•‘  â”‚                                                                  â”‚ â•‘
    â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•¤â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                                â”‚
                                â–¼
                    â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
                    â•‘      ğŸ’¾ CAPA DE PERSISTENCIA (Storage)       â•‘
                    â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â•‘
                    â•‘  â”‚  ğŸ“„ drowsiness_report.csv               â”‚ â•‘
                    â•‘  â”‚  ğŸ“Š JSON Reports (Real-time)            â”‚ â•‘
                    â•‘  â”‚  ğŸ“¸ Processed Frames (Base64)           â”‚ â•‘
                    â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â•‘
                    â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ”„ Flujo de Datos

### ğŸ“Š Diagrama de Secuencia Completo

```mermaid
sequenceDiagram
    participant U as ğŸ‘¤ Usuario
    participant GUI as ğŸ¨ Interfaz Flet
    participant WS as ğŸ”Œ WebSocket
    participant Core as ğŸ§  Core System
    participant PE as ğŸ“ Points Extractor
    participant MP as ğŸ”¬ MediaPipe
    participant DP as ğŸ“Š Data Processor
    participant FD as ğŸ¯ Features Detector
    participant VIS as ğŸ¨ Visualizer
    participant REP as ğŸ“ˆ Reporter
    participant DB as ğŸ’¾ Storage

    U->>GUI: 1ï¸âƒ£ Iniciar detecciÃ³n
    GUI->>WS: 2ï¸âƒ£ Conectar WebSocket
    WS->>Core: 3ï¸âƒ£ Establecer conexiÃ³n
    
    loop Cada Frame (30 FPS)
        GUI->>WS: 4ï¸âƒ£ Enviar frame (base64)
        WS->>Core: 5ï¸âƒ£ Recibir frame
        Core->>PE: 6ï¸âƒ£ Extraer puntos
        PE->>MP: 7ï¸âƒ£ Procesar con MediaPipe
        
        par Procesamiento Paralelo
            MP-->>PE: ğŸ”´ 468 puntos faciales
            MP-->>PE: ğŸŸ¢ 42 puntos mano izquierda
            MP-->>PE: ğŸ”µ 42 puntos mano derecha
        end
        
        PE->>DP: 8ï¸âƒ£ Puntos extraÃ­dos
        
        par CÃ¡lculo de Distancias
            DP->>DP: ğŸ‘ï¸ Distancias ojos
            DP->>DP: ğŸ‘„ Apertura boca
            DP->>DP: ğŸ¯ Ãngulo cabeza
            DP->>DP: âœ‹ Proximidad manos
        end
        
        DP->>FD: 9ï¸âƒ£ Datos procesados
        
        par DetecciÃ³n de CaracterÃ­sticas
            FD->>FD: ğŸ” Analizar parpadeo
            FD->>FD: ğŸ” Detectar microsueÃ±o
            FD->>FD: ğŸ” Identificar bostezo
            FD->>FD: ğŸ” Verificar cabeceo
            FD->>FD: ğŸ” Detectar frotamiento
        end
        
        FD->>REP: ğŸ”Ÿ Eventos detectados
        REP->>DB: 1ï¸âƒ£1ï¸âƒ£ Guardar en CSV
        REP->>VIS: 1ï¸âƒ£2ï¸âƒ£ Generar reporte JSON
        
        VIS->>VIS: 1ï¸âƒ£3ï¸âƒ£ Dibujar alertas
        VIS->>Core: 1ï¸âƒ£4ï¸âƒ£ Frame procesado
        Core->>WS: 1ï¸âƒ£5ï¸âƒ£ Enviar respuesta
        WS->>GUI: 1ï¸âƒ£6ï¸âƒ£ Mostrar resultado
        GUI->>U: 1ï¸âƒ£7ï¸âƒ£ Visualizar alertas
    end
```

### ğŸ¬ Pipeline de Procesamiento

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        ğŸ¥ INICIO: FRAME DE CÃMARA                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                        â”‚
                                        â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   ğŸ”„ CodificaciÃ³n Base64  â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  ğŸŒ TransmisiÃ³n WebSocket â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    âš™ï¸ ETAPA 1: EXTRACCIÃ“N DE PUNTOS                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   ğŸ“ PointsExtractor.extract()                                             â”‚
â”‚   â”œâ”€â–º ğŸ”¬ MediaPipe Face Mesh                                               â”‚
â”‚   â”‚   â””â”€â–º âœ… 468 landmarks (x, y, z)                                       â”‚
â”‚   â”‚                                                                         â”‚
â”‚   â””â”€â–º ğŸ”¬ MediaPipe Hands                                                   â”‚
â”‚       â”œâ”€â–º âœ… Mano 1: 21 landmarks                                           â”‚
â”‚       â””â”€â–º âœ… Mano 2: 21 landmarks                                           â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                   ğŸ“Š ETAPA 2: PROCESAMIENTO DE DATOS                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   PointsProcessing.process()                                               â”‚
â”‚   â”‚                                                                         â”‚
â”‚   â”œâ”€â–º ğŸ‘ï¸ EyesProcessor                                                     â”‚
â”‚   â”‚   â”œâ”€ Distancia pÃ¡rpado superior â†” inferior (ojo izquierdo)           â”‚
â”‚   â”‚   â””â”€ Distancia pÃ¡rpado superior â†” inferior (ojo derecho)             â”‚
â”‚   â”‚                                                                         â”‚
â”‚   â”œâ”€â–º ğŸ‘„ MouthProcessor                                                     â”‚
â”‚   â”‚   â”œâ”€ Distancia labio superior â†” labio inferior                        â”‚
â”‚   â”‚   â””â”€ Distancia labio superior â†” mentÃ³n                                â”‚
â”‚   â”‚                                                                         â”‚
â”‚   â”œâ”€â–º ğŸ¯ HeadProcessor                                                      â”‚
â”‚   â”‚   â””â”€ Ãngulo pitch (nariz â†” frente)                                    â”‚
â”‚   â”‚                                                                         â”‚
â”‚   â””â”€â–º âœ‹ HandsProcessor                                                     â”‚
â”‚       â”œâ”€ Mano 1: Distancia dedos â†” ojos                                   â”‚
â”‚       â””â”€ Mano 2: Distancia dedos â†” ojos                                   â”‚
â”‚                                                                             â”‚
â”‚   ğŸ“ CÃ¡lculo: Distancia Euclidiana = âˆš[(xâ‚‚-xâ‚)Â² + (yâ‚‚-yâ‚)Â²]               â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ğŸ¯ ETAPA 3: DETECCIÃ“N DE CARACTERÃSTICAS                       â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                             â”‚
â”‚   FeaturesDrowsinessProcessing.process()                                   â”‚
â”‚   â”‚                                                                         â”‚
â”‚   â”œâ”€â–º ğŸ‘ï¸ FlickerAndMicrosleep                                              â”‚
â”‚   â”‚   â”œâ”€ Contador de parpadeos (ventana 60s)                              â”‚
â”‚   â”‚   â”‚  â””â”€ ğŸš¨ ALERTA: > 15 parpadeos/minuto                              â”‚
â”‚   â”‚   â””â”€ Timer ojos cerrados                                              â”‚
â”‚   â”‚      â””â”€ ğŸš¨ ALERTA: > 2 segundos (microsueÃ±o)                          â”‚
â”‚   â”‚                                                                         â”‚
â”‚   â”œâ”€â–º ğŸ¥± YawnDetection                                                      â”‚
â”‚   â”‚   â”œâ”€ Timer boca abierta                                               â”‚
â”‚   â”‚   â”‚  â””â”€ ğŸš¨ ALERTA: > 4 segundos                                       â”‚
â”‚   â”‚   â””â”€ Contador bostezos (ventana 180s)                                 â”‚
â”‚   â”‚                                                                         â”‚
â”‚   â”œâ”€â–º ğŸ™‡ PitchDetection                                                     â”‚
â”‚   â”‚   â””â”€ Timer cabeza inclinada                                           â”‚
â”‚   â”‚      â””â”€ ğŸš¨ ALERTA: > 3 segundos                                       â”‚
â”‚   â”‚                                                                         â”‚
â”‚   â””â”€â–º ğŸ¤² EyeRubDetection                                                    â”‚
â”‚       â””â”€ Timer manos cerca ojos                                            â”‚
â”‚          â””â”€ ğŸš¨ ALERTA: > 1 segundo (reporte cada 300s)                    â”‚
â”‚                                                                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â–¼                                   â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  ğŸ“ˆ GENERACIÃ“N REPORTES   â”‚       â”‚   ğŸ¨ VISUALIZACIÃ“N        â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚                           â”‚       â”‚                           â”‚
    â”‚ DrowsinessReports         â”‚       â”‚ ReportVisualizer          â”‚
    â”‚ â”œâ”€ CSV: Eventos histÃ³ricosâ”‚       â”‚ â”œâ”€ Alertas en pantalla   â”‚
    â”‚ â””â”€ JSON: Reporte actual   â”‚       â”‚ â”œâ”€ Colores por nivel     â”‚
    â”‚                           â”‚       â”‚ â”‚  ğŸŸ¢ Normal              â”‚
    â”‚ ğŸ’¾ Guardado en:           â”‚       â”‚ â”‚  ğŸŸ¡ Advertencia         â”‚
    â”‚ reports/august/           â”‚       â”‚ â”‚  ğŸ”´ Peligro             â”‚
    â”‚ drowsiness_report.csv     â”‚       â”‚ â””â”€ Overlay en video      â”‚
    â”‚                           â”‚       â”‚                           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                                   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚  ğŸŒ Respuesta WebSocket   â”‚
                        â”‚  â”œâ”€ original_image        â”‚
                        â”‚  â”œâ”€ sketch_image          â”‚
                        â”‚  â””â”€ json_report           â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                                      â–¼
                        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                        â”‚   ğŸ¨ Mostrar en GUI       â”‚
                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§© Componentes Detallados

### 1ï¸âƒ£ **Interfaz GrÃ¡fica (GUI)** ğŸ¨

```
gui/
â”œâ”€â”€ pages/
â”‚   â”œâ”€â”€ ğŸ  start_page.py              â†’ Pantalla de bienvenida
â”‚   â”œâ”€â”€ ğŸ¯ selection_interface_page.py â†’ MenÃº de selecciÃ³n
â”‚   â””â”€â”€ ğŸ˜´ drowsiness_page.py         â†’ PÃ¡gina principal detecciÃ³n
â”‚
â””â”€â”€ resources/
    â”œâ”€â”€ fonts/                        â†’ Fuentes personalizadas
    â”‚   â”œâ”€â”€ BrittanySignature.ttf
    â”‚   â””â”€â”€ Cardo-Regular.ttf
    â””â”€â”€ images/                       â†’ Assets visuales
```

**Funcionalidades:**
- âœ… NavegaciÃ³n entre pÃ¡ginas con rutas
- âœ… Captura de video en tiempo real
- âœ… VisualizaciÃ³n dual (original + sketch 3D)
- âœ… Botones Start/Stop
- âœ… Tema personalizado con transiciones

---

### 2ï¸âƒ£ **Servidor WebSocket (Backend)** ğŸŒ

```python
# app.py - Arquitectura del servidor

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      FastAPI WebSocket Server           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  Endpoint: /ws                          â”‚
â”‚  Puerto: 8000                           â”‚
â”‚                                         â”‚
â”‚  Flujo:                                 â”‚
â”‚  1. Accept connection                   â”‚
â”‚  2. Receive frame (base64)              â”‚
â”‚  3. Process with DrowsinessSystem       â”‚
â”‚  4. Send response:                      â”‚
â”‚     â”œâ”€ original_image (base64)          â”‚
â”‚     â”œâ”€ sketch_image (base64)            â”‚
â”‚     â””â”€ json_report (dict)               â”‚
â”‚                                         â”‚
â”‚  Manejo de errores:                     â”‚
â”‚  â””â”€ WebSocketDisconnect                 â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 3ï¸âƒ£ **Sistema Principal de DetecciÃ³n** ğŸ§ 

```python
# drowsiness_processor/main.py

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚         DrowsinessDetectionSystem                            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                              â”‚
â”‚  Componentes:                                                â”‚
â”‚  â”œâ”€ ğŸ“ PointsExtractor                                       â”‚
â”‚  â”œâ”€ ğŸ“Š PointsProcessing                                      â”‚
â”‚  â”œâ”€ ğŸ¯ FeaturesDrowsinessProcessing                          â”‚
â”‚  â”œâ”€ ğŸ¨ ReportVisualizer                                      â”‚
â”‚  â””â”€ ğŸ“ˆ DrowsinessReports                                     â”‚
â”‚                                                              â”‚
â”‚  MÃ©todo run(frame_base64):                                   â”‚
â”‚  â”œâ”€ 1. Decodificar frame                                     â”‚
â”‚  â”œâ”€ 2. Extraer puntos faciales/manos                         â”‚
â”‚  â”œâ”€ 3. Calcular distancias                                   â”‚
â”‚  â”œâ”€ 4. Detectar caracterÃ­sticas somnolencia                  â”‚
â”‚  â”œâ”€ 5. Generar reporte JSON                                  â”‚
â”‚  â”œâ”€ 6. Visualizar alertas                                    â”‚
â”‚  â””â”€ 7. Retornar (original, sketch, json)                     â”‚
â”‚                                                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### 4ï¸âƒ£ **ExtracciÃ³n de Puntos** ğŸ“

```
extract_points/
â”œâ”€â”€ point_extractor.py         â†’ Orquestador principal
â”œâ”€â”€ face_mesh/
â”‚   â””â”€â”€ face_mesh_processor.py â†’ MediaPipe Face Mesh
â””â”€â”€ hands/
    â””â”€â”€ hands_processor.py     â†’ MediaPipe Hands

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              ğŸ”¬ DETECCIÃ“N CON MEDIAPIPE                       â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                               â•‘
â•‘  ğŸ‘ï¸ Face Mesh:                                                â•‘
â•‘  â”œâ”€ 468 landmarks 3D (x, y, z)                               â•‘
â•‘  â”œâ”€ Puntos de interÃ©s:                                       â•‘
â•‘  â”‚  â”œâ”€ Ojos: 6 puntos por ojo                               â•‘
â•‘  â”‚  â”œâ”€ Boca: 20 puntos                                      â•‘
â•‘  â”‚  â””â”€ Cabeza: Nariz, frente                                â•‘
â•‘  â””â”€ Confidence score                                         â•‘
â•‘                                                               â•‘
â•‘  ğŸ¤² Hands:                                                     â•‘
â•‘  â”œâ”€ 21 landmarks por mano                                    â•‘
â•‘  â”œâ”€ DetecciÃ³n hasta 2 manos simultÃ¡neas                     â•‘
â•‘  â”œâ”€ Puntos de dedos usados para eye_rub                     â•‘
â•‘  â””â”€ Coordenadas normalizadas [0-1]                          â•‘
â•‘                                                               â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**Puntos Faciales Clave:**

```
     ğŸ”´ Frente (8)
          â”‚
      ğŸ‘€ Ojos
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
   (159)    (386)  â† PÃ¡rpados superiores
   (145)    (374)  â† PÃ¡rpados inferiores
          â”‚
     ğŸ”µ Nariz (1)
          â”‚
      ğŸ‘„ Boca
    â”Œâ”€â”€â”€â”€â”´â”€â”€â”€â”€â”
    (13)  (14)     â† Labios superior/inferior
    (152)          â† MentÃ³n
```

---

### 5ï¸âƒ£ **Procesamiento de Datos** ğŸ“Š

```
data_processing/
â”œâ”€â”€ main.py                    â†’ PointsProcessing (orquestador)
â”œâ”€â”€ eyes/
â”‚   â””â”€â”€ eyes_processing.py     â†’ Distancia pÃ¡rpados
â”œâ”€â”€ mouth/
â”‚   â””â”€â”€ mouth_processing.py    â†’ Apertura labial
â”œâ”€â”€ head/
â”‚   â””â”€â”€ head_processing.py     â†’ Ãngulo pitch
â””â”€â”€ hands/
    â”œâ”€â”€ first_hand/
    â”‚   â””â”€â”€ first_hand_processing.py
    â””â”€â”€ second_hand/
        â””â”€â”€ second_hand_processing.py

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘          ğŸ“ CÃLCULOS DE DISTANCIAS EUCLIDIANAS               â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                              â•‘
â•‘  FÃ³rmula: d = âˆš[(xâ‚‚ - xâ‚)Â² + (yâ‚‚ - yâ‚)Â²]                   â•‘
â•‘                                                              â•‘
â•‘  ğŸ‘ï¸ Ojos:                                                    â•‘
â•‘  â”œâ”€ left_eye_distance = dist(159, 145)                      â•‘
â•‘  â””â”€ right_eye_distance = dist(386, 374)                     â•‘
â•‘                                                              â•‘
â•‘  ğŸ‘„ Boca:                                                     â•‘
â•‘  â”œâ”€ mouth_distance = dist(13, 14)                           â•‘
â•‘  â””â”€ chin_distance = dist(14, 152)                           â•‘
â•‘                                                              â•‘
â•‘  ğŸ¯ Cabeza:                                                   â•‘
â•‘  â””â”€ pitch_angle = dist(1, 8)                                â•‘
â•‘                                                              â•‘
â•‘  âœ‹ Manos:                                                    â•‘
â•‘  â”œâ”€ hand1_to_eyes = min(dist(finger, eye))                  â•‘
â•‘  â””â”€ hand2_to_eyes = min(dist(finger, eye))                  â•‘
â•‘                                                              â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

### 6ï¸âƒ£ **DetecciÃ³n de CaracterÃ­sticas** ğŸ¯

```
drowsiness_features/
â”œâ”€â”€ processor.py                       â†’ DrowsinessProcessor
â”œâ”€â”€ processing.py                      â†’ FeaturesDrowsinessProcessing
â”œâ”€â”€ flicker_and_microsleep/
â”‚   â””â”€â”€ processing.py                  â†’ Parpadeo y microsueÃ±o
â”œâ”€â”€ yawn/
â”‚   â””â”€â”€ processing.py                  â†’ DetecciÃ³n de bostezos
â”œâ”€â”€ pitch/
â”‚   â””â”€â”€ processing.py                  â†’ DetecciÃ³n de cabeceo
â””â”€â”€ eye_rub/
    â””â”€â”€ processing.py                  â†’ Frotamiento de ojos

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘            ğŸš¨ SISTEMA DE ALERTAS Y UMBRALES                        â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                    â•‘
â•‘  ğŸ‘ï¸ PARPADEO (Flicker):                                            â•‘
â•‘  â”œâ”€ Ventana temporal: 60 segundos                                 â•‘
â•‘  â”œâ”€ Umbral: 15 parpadeos                                          â•‘
â•‘  â”œâ”€ Estado: eyes_closed = True/False                              â•‘
â•‘  â””â”€ ğŸŸ¡ Alerta: "Parpadeo frecuente detectado"                     â•‘
â•‘                                                                    â•‘
â•‘  ğŸ˜´ MICROSUEÃ‘O (Microsleep):                                       â•‘
â•‘  â”œâ”€ DuraciÃ³n mÃ­nima: 2 segundos                                   â•‘
â•‘  â”œâ”€ CondiciÃ³n: Ojos cerrados continuamente                        â•‘
â•‘  â””â”€ ğŸ”´ Alerta: "Â¡MICROSUEÃ‘O DETECTADO!"                           â•‘
â•‘                                                                    â•‘
â•‘  ğŸ¥± BOSTEZO (Yawn):                                                â•‘
â•‘  â”œâ”€ DuraciÃ³n mÃ­nima: 4 segundos                                   â•‘
â•‘  â”œâ”€ Ventana temporal: 180 segundos                                â•‘
â•‘  â”œâ”€ CondiciÃ³n: mouth_distance > umbral                            â•‘
â•‘  â””â”€ ğŸŸ¡ Alerta: "Bostezo prolongado"                               â•‘
â•‘                                                                    â•‘
â•‘  ğŸ™‡ CABECEO (Pitch):                                               â•‘
â•‘  â”œâ”€ DuraciÃ³n mÃ­nima: 3 segundos                                   â•‘
â•‘  â”œâ”€ CondiciÃ³n: Cabeza inclinada hacia abajo                       â•‘
â•‘  â””â”€ ğŸ”´ Alerta: "Cabeceo detectado"                                â•‘
â•‘                                                                    â•‘
â•‘  ğŸ¤² FROTAMIENTO OJOS (Eye Rub):                                    â•‘
â•‘  â”œâ”€ DuraciÃ³n mÃ­nima: 1 segundo                                    â•‘
â•‘  â”œâ”€ Cooldown: 300 segundos entre reportes                         â•‘
â•‘  â”œâ”€ CondiciÃ³n: Manos cerca de ojos                                â•‘
â•‘  â””â”€ ğŸŸ¡ Alerta: "Frotamiento de ojos"                              â•‘
â•‘                                                                    â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

**MÃ¡quina de Estados - DetecciÃ³n de MicrosueÃ±o:**

```mermaid
stateDiagram-v2
    [*] --> OjosAbiertos
    OjosAbiertos --> OjosCerrados: eyes_closed = True
    OjosCerrados --> OjosAbiertos: eyes_closed = False\n(< 2s)
    OjosCerrados --> MicrosueÃ±o: DuraciÃ³n >= 2s
    MicrosueÃ±o --> OjosAbiertos: eyes_closed = False
    MicrosueÃ±o --> [*]: Reportar evento
```

---

### 7ï¸âƒ£ **VisualizaciÃ³n y Reportes** ğŸ“Š

```
visualization/
â””â”€â”€ main.py                    â†’ ReportVisualizer

reports/
â”œâ”€â”€ main.py                    â†’ DrowsinessReports
â””â”€â”€ august/
    â””â”€â”€ drowsiness_report.csv  â†’ HistÃ³rico de eventos

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              ğŸ¨ SISTEMA DE VISUALIZACIÃ“N                          â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                   â•‘
â•‘  Colores por nivel de alerta:                                    â•‘
â•‘  â”œâ”€ ğŸŸ¢ Verde (0, 255, 0): Normal                                 â•‘
â•‘  â”œâ”€ ğŸŸ¡ Amarillo (0, 255, 255): Advertencia                       â•‘
â•‘  â””â”€ ğŸ”´ Rojo (0, 0, 255): Peligro                                 â•‘
â•‘                                                                   â•‘
â•‘  Elementos visuales:                                             â•‘
â•‘  â”œâ”€ RectÃ¡ngulo de alerta (esquina superior izquierda)           â•‘
â•‘  â”œâ”€ Texto descriptivo del evento                                 â•‘
â•‘  â”œâ”€ Timestamp del evento                                         â•‘
â•‘  â””â”€ Puntos faciales dibujados                                    â•‘
â•‘                                                                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              ğŸ“Š ESTRUCTURA DE REPORTES                            â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                                   â•‘
â•‘  CSV (drowsiness_report.csv):                                    â•‘
â•‘  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘  â”‚ Timestamp â”‚ Feature  â”‚ Duration(s) â”‚ Status     â”‚            â•‘
â•‘  â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤            â•‘
â•‘  â”‚ 10:30:15  â”‚ Flicker  â”‚ 60          â”‚ 18 blinks  â”‚            â•‘
â•‘  â”‚ 10:30:20  â”‚ Microsleepâ”‚ 3.2        â”‚ Detected   â”‚            â•‘
â•‘  â”‚ 10:31:05  â”‚ Yawn     â”‚ 5.1         â”‚ Detected   â”‚            â•‘
â•‘  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â•‘
â•‘                                                                   â•‘
â•‘  JSON (tiempo real):                                             â•‘
â•‘  {                                                                â•‘
â•‘    "flicker": {                                                   â•‘
â•‘      "is_drowsiness": true,                                      â•‘
â•‘      "blink_count": 18,                                          â•‘
â•‘      "message": "Parpadeo frecuente"                             â•‘
â•‘    },                                                             â•‘
â•‘    "microsleep": {                                                â•‘
â•‘      "is_drowsiness": true,                                      â•‘
â•‘      "duration": 3.2,                                            â•‘
â•‘      "message": "Â¡MICROSUEÃ‘O!"                                   â•‘
â•‘    }                                                              â•‘
â•‘  }                                                                â•‘
â•‘                                                                   â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

---

## ğŸ“¦ InstalaciÃ³n

### Requisitos Previos

```bash
- Python 3.12+
- CÃ¡mara web
- Sistema operativo: Linux / Windows / macOS
```

### Paso 1: Clonar el repositorio

```bash
git clone https://github.com/tu-usuario/sistema-deteccion-somnolencia.git
cd sistema-deteccion-somnolencia
```

### Paso 2: Crear entorno virtual

```bash
python -m venv venv
source venv/bin/activate  # Linux/Mac
# o
venv\Scripts\activate  # Windows
```

### Paso 3: Instalar dependencias

```bash
pip install -r requirements.txt
```

**Dependencias principales:**
```
fastapi==0.109.0
uvicorn[standard]==0.27.0
websockets==12.0
flet==0.21.0
mediapipe==0.10.9
opencv-python==4.9.0.80
numpy==1.26.3
```

### Paso 4: Ejecutar el sistema

**Terminal 1 - Servidor Backend:**
```bash
uvicorn app:app --reload --host 0.0.0.0 --port 8000
```

**Terminal 2 - Interfaz GrÃ¡fica:**
```bash
python main.py
```

---

## ğŸš€ Uso

### OpciÃ³n 1: Interfaz GrÃ¡fica (Recomendado)

1. Ejecutar `python main.py`
2. Navegar: Inicio â†’ SelecciÃ³n â†’ DetecciÃ³n Somnolencia
3. Presionar **Start** para iniciar
4. Presionar **Stop** para detener

### OpciÃ³n 2: Cliente de Prueba

```bash
python client.py
```

### Ejemplo de CÃ³digo - Cliente Personalizado

```python
import cv2
import base64
import asyncio
import websockets
import json

async def detect_drowsiness():
    uri = "ws://localhost:8000/ws"
    
    async with websockets.connect(uri) as websocket:
        cap = cv2.VideoCapture(0)
        
        while cap.isOpened():
            ret, frame = cap.read()
            if not ret:
                break
            
            # Codificar frame
            _, buffer = cv2.imencode('.jpg', frame)
            frame_base64 = base64.b64encode(buffer).decode('utf-8')
            
            # Enviar al servidor
            await websocket.send(frame_base64)
            
            # Recibir respuesta
            response = await websocket.recv()
            data = json.loads(response)
            
            # Procesar respuesta
            json_report = data['json_report']
            sketch_base64 = data['sketch_image']
            
            print(f"Alertas: {json_report}")
            
            # Mostrar video
            sketch_bytes = base64.b64decode(sketch_base64)
            nparr = np.frombuffer(sketch_bytes, np.uint8)
            sketch = cv2.imdecode(nparr, cv2.IMREAD_COLOR)
            
            cv2.imshow('DetecciÃ³n', sketch)
            
            if cv2.waitKey(1) & 0xFF == ord('q'):
                break
        
        cap.release()
        cv2.destroyAllWindows()

asyncio.run(detect_drowsiness())
```

---

## ğŸ“Š MÃ©tricas de DetecciÃ³n

### Tabla de Umbrales

| CaracterÃ­stica | Umbral MÃ­nimo | Ventana Temporal | Nivel de Alerta |
|----------------|---------------|------------------|-----------------|
| ğŸ‘ï¸ **Parpadeo** | 15 parpadeos | 60 segundos | ğŸŸ¡ Advertencia |
| ğŸ˜´ **MicrosueÃ±o** | 2 segundos | N/A | ğŸ”´ Peligro |
| ğŸ¥± **Bostezo** | 4 segundos | 180 segundos | ğŸŸ¡ Advertencia |
| ğŸ™‡ **Cabeceo** | 3 segundos | N/A | ğŸ”´ Peligro |
| ğŸ¤² **Frotamiento** | 1 segundo | 300s cooldown | ğŸŸ¡ Advertencia |

### Rendimiento del Sistema

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚       âš¡ MÃ‰TRICAS DE RENDIMIENTO        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                         â”‚
â”‚  FPS: 30+ frames/segundo                â”‚
â”‚  Latencia: < 50ms                       â”‚
â”‚  PrecisiÃ³n Face Mesh: ~95%              â”‚
â”‚  PrecisiÃ³n Hands: ~90%                  â”‚
â”‚  CPU Usage: 40-60%                      â”‚
â”‚  RAM Usage: ~500MB                      â”‚
â”‚                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“š DocumentaciÃ³n TÃ©cnica

### Estructura de Directorios Completa

```
sistema-deteccion-somnolencia/
â”‚
â”œâ”€â”€ ğŸ“„ main.py                      # Punto de entrada GUI
â”œâ”€â”€ ğŸ“„ app.py                       # Servidor FastAPI
â”œâ”€â”€ ğŸ“„ client.py                    # Cliente de prueba
â”œâ”€â”€ ğŸ“„ requirements.txt             # Dependencias
â”œâ”€â”€ ğŸ“„ SISTEMA_SOMNOLENCIA.MD      # Este archivo
â”‚
â”œâ”€â”€ ğŸ¨ gui/                         # Interfaz grÃ¡fica
â”‚   â”œâ”€â”€ pages/
â”‚   â”‚   â”œâ”€â”€ start_page.py
â”‚   â”‚   â”œâ”€â”€ selection_interface_page.py
â”‚   â”‚   â””â”€â”€ drowsiness_page.py
â”‚   â””â”€â”€ resources/
â”‚       â”œâ”€â”€ fonts/
â”‚       â””â”€â”€ images/
â”‚
â”œâ”€â”€ âš™ï¸ drowsiness_processor/        # Motor de detecciÃ³n
â”‚   â”œâ”€â”€ main.py
â”‚   â”œâ”€â”€ extract_points/            # ExtracciÃ³n MediaPipe
â”‚   â”œâ”€â”€ data_processing/           # CÃ¡lculo distancias
â”‚   â”œâ”€â”€ drowsiness_features/       # DetecciÃ³n caracterÃ­sticas
â”‚   â”œâ”€â”€ visualization/             # Overlay visual
â”‚   â””â”€â”€ reports/                   # GeneraciÃ³n reportes
â”‚
â”œâ”€â”€ ğŸ§ª tests/                       # Tests unitarios
â”‚   â””â”€â”€ videos/                    # Videos de prueba
â”‚
â”œâ”€â”€ ğŸ“– docs/                        # DocumentaciÃ³n visual
â”‚   â”œâ”€â”€ diagrama.png
â”‚   â”œâ”€â”€ malla_facial/
â”‚   â””â”€â”€ manos/
â”‚
â””â”€â”€ ğŸ’¡ examples/                    # Ejemplos de uso
    â”œâ”€â”€ camera.py
    â””â”€â”€ video_stream.py
```

### Patrones de DiseÃ±o Utilizados

```
â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
â•‘              ğŸ—ï¸ PATRONES DE DISEÃ‘O                        â•‘
â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£
â•‘                                                            â•‘
â•‘  ğŸ¯ Strategy Pattern                                       â•‘
â•‘  â””â”€ Diferentes estrategias de detecciÃ³n por feature       â•‘
â•‘                                                            â•‘
â•‘  ğŸ­ Factory Pattern                                        â•‘
â•‘  â””â”€ CreaciÃ³n de procesadores de datos                     â•‘
â•‘                                                            â•‘
â•‘  ğŸ‘ï¸ Observer Pattern                                       â•‘
â•‘  â””â”€ Sistema de eventos para alertas                       â•‘
â•‘                                                            â•‘
â•‘  ğŸ”Œ Facade Pattern                                         â•‘
â•‘  â””â”€ DrowsinessDetectionSystem como fachada                â•‘
â•‘                                                            â•‘
â•‘  ğŸ¨ Template Method                                        â•‘
â•‘  â””â”€ Procesamiento comÃºn en clase base                     â•‘
â•‘                                                            â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
```

### API WebSocket

**Endpoint:** `ws://localhost:8000/ws`

**Request:**
```json
{
  "type": "frame",
  "data": "base64_encoded_image..."
}
```

**Response:**
```json
{
  "json_report": {
    "flicker": {
      "is_drowsiness": false,
      "blink_count": 8,
      "time_window": 60,
      "message": ""
    },
    "microsleep": {
      "is_drowsiness": false,
      "duration": 0.0,
      "message": ""
    },
    "yawn": {
      "is_drowsiness": false,
      "duration": 0.0,
      "yawn_count": 0,
      "message": ""
    },
    "pitch": {
      "is_drowsiness": false,
      "duration": 0.0,
      "message": ""
    },
    "eye_rub": {
      "is_drowsiness": false,
      "duration": 0.0,
      "hand": "none",
      "message": ""
    }
  },
  "sketch_image": "base64_encoded_processed_image...",
  "original_image": "base64_encoded_original_image..."
}
```

---

## ğŸ³ Docker (Opcional)

```dockerfile
FROM python:3.12-slim

WORKDIR /app

# Instalar dependencias del sistema
RUN apt-get update && apt-get install -y \
    libglib2.0-0 \
    libsm6 \
    libxext6 \
    libxrender-dev \
    libgomp1 \
    libgstreamer1.0-0 \
    && rm -rf /var/lib/apt/lists/*

# Copiar archivos
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

COPY . .

# Exponer puerto
EXPOSE 8000

# Comando de inicio
CMD ["uvicorn", "app:app", "--host", "0.0.0.0", "--port", "8000"]
```

**Build y Run:**
```bash
docker build -t drowsiness-system .
docker run -p 8000:8000 drowsiness-system
```

---

## ğŸ¤ ContribuciÃ³n

Â¡Las contribuciones son bienvenidas! Por favor:

1. Fork el proyecto
2. Crea una rama feature (`git checkout -b feature/NuevaCaracteristica`)
3. Commit tus cambios (`git commit -m 'Agregar nueva caracterÃ­stica'`)
4. Push a la rama (`git push origin feature/NuevaCaracteristica`)
5. Abre un Pull Request

---

## ğŸ“ Licencia

Este proyecto estÃ¡ bajo la Licencia MIT. Ver archivo `LICENSE` para mÃ¡s detalles.

---

## ğŸ‘¨â€ğŸ’» Autor

**Educare IA Team**

- ğŸ“§ Email: contacto@educareai.com
- ğŸŒ Website: https://educareai.com
- ğŸ’¼ LinkedIn: [Educare IA](https://linkedin.com/company/educareai)

---

## ğŸ™ Agradecimientos

- [MediaPipe](https://google.github.io/mediapipe/) - Framework de ML
- [FastAPI](https://fastapi.tiangolo.com/) - Framework web
- [Flet](https://flet.dev/) - Framework GUI
- [OpenCV](https://opencv.org/) - VisiÃ³n por computadora

---

<div align="center">

### â­ Si este proyecto te fue Ãºtil, considera darle una estrella â­

**Desarrollado con â¤ï¸ por Educare IA**

</div>